# 生产环境部署配置示例
# 复制此文件为 docker-compose.override.yml 进行自定义配置

version: '3.8'

services:
  # 应用服务自定义配置
  app:
    # 自定义端口
    ports:
      - "3000:3000"

    # 自定义环境变量
    environment:
      # 站点配置
      SITE_NAME: "我的网站"
      SITE_URL: "https://your-domain.com"

      # 日志级别
      LOG_LEVEL: "info"

    # 资源限制
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G

    # 重启策略
    restart: unless-stopped

  # 数据库服务自定义配置
  postgres:
    # 自定义端口（仅本地访问）
    ports:
      - "127.0.0.1:5432:5432"

    # 资源限制
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M

    # 重启策略
    restart: unless-stopped

    # 数据库性能优化
    command:
      - "postgres"
      - "-c"
      - "max_connections=200"
      - "-c"
      - "shared_buffers=256MB"
      - "-c"
      - "effective_cache_size=1GB"

# 自定义网络配置
networks:
  wylm-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
